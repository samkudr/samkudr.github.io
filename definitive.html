<html>

<head>

<title>Definitive Healthcare Feed</title>
<meta http-equiv="Cache-Control" content="no-store" />

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="https://www.promisejs.org/polyfills/promise-7.0.4.min.js"></script>
<script src="https://connectors.tableau.com/libs/tableauwdc-2.2.latest.js" type="text/javascript"></script>


<script type="text/javascript">
(function () {

	var myConnector = tableau.makeConnector();
	
	myConnector.getSchema = function (schemaCallback) {

		var hospitalTable = {
			id: "Hospital",
			columns: [
				{id: "Id", dataType: tableau.dataTypeEnum.int},
				{id: "Name", dataType: tableau.dataTypeEnum.string},
				{id: "FirmType", dataType: tableau.dataTypeEnum.string},
				{id: "WebSite", dataType: tableau.dataTypeEnum.string},
				{id: "Description", dataType: tableau.dataTypeEnum.string},
				{id: "Address", dataType: tableau.dataTypeEnum.string},
				{id: "Address1", dataType: tableau.dataTypeEnum.string},
				{id: "HQCity", dataType: tableau.dataTypeEnum.string},
				{id: "State", dataType: tableau.dataTypeEnum.string},
				{id: "Zip", dataType: tableau.dataTypeEnum.string},
				{id: "CountryCode", dataType: tableau.dataTypeEnum.string},
				{id: "Phone", dataType: tableau.dataTypeEnum.string},
				{id: "NetPatientRev", dataType: tableau.dataTypeEnum.int},
				{id: "NetworkId", dataType: tableau.dataTypeEnum.int},
				{id: "NetworkParentId", dataType: tableau.dataTypeEnum.int},
				{id: "NetworkName", dataType: tableau.dataTypeEnum.string},
				{id: "NetworkParentName", dataType: tableau.dataTypeEnum.string},
				{id: "NumEmployees", dataType: tableau.dataTypeEnum.int},
				{id: "NumBeds", dataType: tableau.dataTypeEnum.int},
				{id: "CashOnHand", dataType: tableau.dataTypeEnum.int},
				{id: "EMRVendorAmbulatory", dataType: tableau.dataTypeEnum.string},
				{id: "EMRVendorInpatient", dataType: tableau.dataTypeEnum.string},
				{id: "MeaningfulUseStatus", dataType: tableau.dataTypeEnum.string},
				{id: "NumOperatingRooms", dataType: tableau.dataTypeEnum.int},
				{id: "NumDischarges", dataType: tableau.dataTypeEnum.int},
				{id: "OperatingIncome", dataType: tableau.dataTypeEnum.float},
				{id: "MedicareProviderNumber", dataType: tableau.dataTypeEnum.string},
				{id: "PayorMixPctMedicaid", dataType: tableau.dataTypeEnum.float},
				{id: "PayorMixPctMedicare", dataType: tableau.dataTypeEnum.float},
				{id: "PayorMixPctPrivateSelf", dataType: tableau.dataTypeEnum.float},
				{id: "AffiliationsGPO", dataType: tableau.dataTypeEnum.string},
				{id: "AffiliationsACO", dataType: tableau.dataTypeEnum.string},
				{id: "DHCProfile", dataType: tableau.dataTypeEnum.string},
				{id: "StateAbbr", dataType: tableau.dataTypeEnum.string},
				{id: "FirmTypeId", dataType: tableau.dataTypeEnum.int},
				{id: "StateFull", dataType: tableau.dataTypeEnum.string},
				{id: "FinancialDataDate", dataType: tableau.dataTypeEnum.datetime},
				{id: "NPINumber", dataType: tableau.dataTypeEnum.string},
				{id: "NumHospitals", dataType: tableau.dataTypeEnum.int},
				{id: "Births", dataType: tableau.dataTypeEnum.float},
				{id: "ACOType", dataType: tableau.dataTypeEnum.string},
				{id: "ACOStartDate", dataType: tableau.dataTypeEnum.datetime},
				{id: "ACOPatientPopulation", dataType: tableau.dataTypeEnum.int},
				{id: "ACONumPhysicians", dataType: tableau.dataTypeEnum.int},
				{id: "NetMedicaidRev", dataType: tableau.dataTypeEnum.float},
				{id: "NetMedicareRev", dataType: tableau.dataTypeEnum.float},
				{id: "TotalOperatingExpenses", dataType: tableau.dataTypeEnum.float},
				{id: "TotalSalaries", dataType: tableau.dataTypeEnum.float},
				{id: "NetIncome", dataType: tableau.dataTypeEnum.float},
				{id: "NetIncomeMargin", dataType: tableau.dataTypeEnum.float},
				{id: "EBITDA", dataType: tableau.dataTypeEnum.float},
				{id: "TempInvestments", dataType: tableau.dataTypeEnum.float},
				{id: "AccountsReceivable", dataType: tableau.dataTypeEnum.float},
				{id: "DaysSalesOutstanding", dataType: tableau.dataTypeEnum.float},
				{id: "TotalFixedAssets", dataType: tableau.dataTypeEnum.float},
				{id: "TotalAssets", dataType: tableau.dataTypeEnum.float},
				{id: "TotalCurrentLiabilities", dataType: tableau.dataTypeEnum.float},
				{id: "LongTermLiabilities", dataType: tableau.dataTypeEnum.float},
				{id: "TotalLiabilities", dataType: tableau.dataTypeEnum.float},
				{id: "CurrentRatio", dataType: tableau.dataTypeEnum.float},
				{id: "QuickRatioTest", dataType: tableau.dataTypeEnum.float},
				{id: "BadDebt", dataType: tableau.dataTypeEnum.float},
				{id: "BadDebtNPRRatio", dataType: tableau.dataTypeEnum.float},
				{id: "MeaningfulUsePayment", dataType: tableau.dataTypeEnum.float},
				{id: "TotalDirectPremiumEarned", dataType: tableau.dataTypeEnum.float},
				{id: "TotalCoveredLives", dataType: tableau.dataTypeEnum.float},
				{id: "TotalInccuredClaims", dataType: tableau.dataTypeEnum.float},
				{id: "ITOperatingSpend", dataType: tableau.dataTypeEnum.float},
				{id: "ITCapitalSpend", dataType: tableau.dataTypeEnum.float},
				{id: "NetOperatingMargin", dataType: tableau.dataTypeEnum.float},
				{id: "DSHPaymentMedicare", dataType: tableau.dataTypeEnum.float},
				{id: "ReadmissionRatePenaltyFY2015", dataType: tableau.dataTypeEnum.float},
				{id: "ReadmissionRatePenaltyFY2014", dataType: tableau.dataTypeEnum.float},
				{id: "ReadmissionRatePenaltyFY2013", dataType: tableau.dataTypeEnum.float},
				{id: "VBPPercentageFY2014", dataType: tableau.dataTypeEnum.float},
				{id: "VBPPercentageFY2013", dataType: tableau.dataTypeEnum.float},
				{id: "ASCNumberClaims", dataType: tableau.dataTypeEnum.float},
				{id: "ASCTotalCharges", dataType: tableau.dataTypeEnum.float},
				{id: "ASCChargePerClaim", dataType: tableau.dataTypeEnum.float},
				{id: "ASCChargePerClaimNational", dataType: tableau.dataTypeEnum.float},
				{id: "ASCChargePerClaimState", dataType: tableau.dataTypeEnum.float},
				{id: "CPOE", dataType: tableau.dataTypeEnum.string},
				{id: "HIS", dataType: tableau.dataTypeEnum.string},
				{id: "PM", dataType: tableau.dataTypeEnum.string},
				{id: "BI", dataType: tableau.dataTypeEnum.string},
				{id: "CIS", dataType: tableau.dataTypeEnum.string},
				{id: "EDIS", dataType: tableau.dataTypeEnum.string},
				{id: "SURG", dataType: tableau.dataTypeEnum.string},
				{id: "CARECOOR", dataType: tableau.dataTypeEnum.string},
				{id: "PDOC", dataType: tableau.dataTypeEnum.string},
				{id: "RIS", dataType: tableau.dataTypeEnum.string},
				{id: "PACS", dataType: tableau.dataTypeEnum.string},
				{id: "LIS", dataType: tableau.dataTypeEnum.string},
				{id: "PHARMA", dataType: tableau.dataTypeEnum.string},
				{id: "HIE", dataType: tableau.dataTypeEnum.string},
				{id: "EDM", dataType: tableau.dataTypeEnum.string},
				{id: "PATACCESS", dataType: tableau.dataTypeEnum.string},
				{id: "PATACCOUNT", dataType: tableau.dataTypeEnum.string},
				{id: "RCM", dataType: tableau.dataTypeEnum.string},
				{id: "TRANSC", dataType: tableau.dataTypeEnum.string},
				{id: "CODE", dataType: tableau.dataTypeEnum.string},
				{id: "FiscalYearEnd", dataType: tableau.dataTypeEnum.string},
				{id: "MedSchlAffiliation", dataType: tableau.dataTypeEnum.string},
				{id: "MainSpecialty", dataType: tableau.dataTypeEnum.string},
				{id: "OtherSpecialties", dataType: tableau.dataTypeEnum.string},
				{id: "PGNumPhysicians", dataType: tableau.dataTypeEnum.int},
				{id: "PGNumProcs", dataType: tableau.dataTypeEnum.int},
				{id: "PGMedicareChargeAmt", dataType: tableau.dataTypeEnum.float},
				{id: "PGMedicarePaymentAmt", dataType: tableau.dataTypeEnum.float},
				{id: "PGHospAffiliationId1", dataType: tableau.dataTypeEnum.int},
				{id: "PGHospAffiliationName1", dataType: tableau.dataTypeEnum.string},
				{id: "PGHospAffiliationId2", dataType: tableau.dataTypeEnum.int},
				{id: "PGHospAffiliationName2", dataType: tableau.dataTypeEnum.string},
				{id: "PGHospAffiliationId3", dataType: tableau.dataTypeEnum.int},
				{id: "PGHospAffiliationName3", dataType: tableau.dataTypeEnum.string},
				{id: "DaysCashOnHand", dataType: tableau.dataTypeEnum.float},
				{id: "HospitalOwnership", dataType: tableau.dataTypeEnum.string},
				{id: "NumAffiliatedPhysicians", dataType: tableau.dataTypeEnum.int},
				{id: "NumBedsMedicare", dataType: tableau.dataTypeEnum.int},
				{id: "MedicareCharges", dataType: tableau.dataTypeEnum.float},
				{id: "AvgLengthOfStay", dataType: tableau.dataTypeEnum.float},
				{id: "DateEntered", dataType: tableau.dataTypeEnum.datetime},
				{id: "AvgDailyCensus", dataType: tableau.dataTypeEnum.float},
				{id: "HIEAffiliations", dataType: tableau.dataTypeEnum.string},
				{id: "HospitalType", dataType: tableau.dataTypeEnum.string},
				{id: "PctHLngPrUlc", dataType: tableau.dataTypeEnum.float},
				{id: "PctLngFallsMajInj", dataType: tableau.dataTypeEnum.float},
				{id: "PctLngMoveWorse", dataType: tableau.dataTypeEnum.float},
				{id: "PctongCatLeftBlad", dataType: tableau.dataTypeEnum.float},
				{id: "PctLngUti", dataType: tableau.dataTypeEnum.float},
				{id: "PctLowLongCtrl", dataType: tableau.dataTypeEnum.float},
				{id: "PctShortImpFcn", dataType: tableau.dataTypeEnum.float},
				{id: "PctSortPrNewWorse", dataType: tableau.dataTypeEnum.float},
				{id: "TotDys", dataType: tableau.dataTypeEnum.float},
				{id: "BedDysAvail", dataType: tableau.dataTypeEnum.float},
				{id: "NumDishTitleXVIII", dataType: tableau.dataTypeEnum.float},
				{id: "OverallRat", dataType: tableau.dataTypeEnum.string},
				{id: "QaulRat", dataType: tableau.dataTypeEnum.string},
				{id: "StaffRat", dataType: tableau.dataTypeEnum.string},
				{id: "RnStaffRat", dataType: tableau.dataTypeEnum.string},
				{id: "HealthInspctRat", dataType: tableau.dataTypeEnum.string},
				{id: "TotErVisits", dataType: tableau.dataTypeEnum.float},
				{id: "HQRegion", dataType: tableau.dataTypeEnum.string}
			]
		};

		var executiveTable = {
			id: "Executive",
			columns: [
				{id: "Id", dataType: tableau.dataTypeEnum.int},
				{id: "LocId", dataType: tableau.dataTypeEnum.int},
				{id: "HospitalId", dataType: tableau.dataTypeEnum.int},
				{id: "DateEntered", dataType: tableau.dataTypeEnum.datetime},
				{id: "ExecName", dataType: tableau.dataTypeEnum.string},
				{id: "FirstName", dataType: tableau.dataTypeEnum.string},
				{id: "LastName", dataType: tableau.dataTypeEnum.string},
				{id: "Title", dataType: tableau.dataTypeEnum.string},
				{id: "Bio", dataType: tableau.dataTypeEnum.string},
				{id: "Phone", dataType: tableau.dataTypeEnum.string},
				{id: "Email", dataType: tableau.dataTypeEnum.string},
				{id: "DocFlag", dataType: tableau.dataTypeEnum.string},
				{id: "Gender", dataType: tableau.dataTypeEnum.string},
				{id: "Prefix", dataType: tableau.dataTypeEnum.string},
				{id: "Suffix", dataType: tableau.dataTypeEnum.string},
				{id: "GroupedTitle", dataType: tableau.dataTypeEnum.string},
				{id: "FirmType", dataType: tableau.dataTypeEnum.string},
				{id: "FuncGroup", dataType: tableau.dataTypeEnum.string},
				{id: "PositionLevel", dataType: tableau.dataTypeEnum.string},
				{id: "LocPhone", dataType: tableau.dataTypeEnum.string},
				{id: "CombinedPhone", dataType: tableau.dataTypeEnum.string},
				{id: "PositionLevelCode", dataType: tableau.dataTypeEnum.string},
				{id: "HimTitle", dataType: tableau.dataTypeEnum.string},
				{id: "RevenueCycleTitle", dataType: tableau.dataTypeEnum.string},
				{id: "ComplianceTitle", dataType: tableau.dataTypeEnum.string},
				{id: "RecordChangedDate", dataType: tableau.dataTypeEnum.datetime},
				{id: "LinkedInProfile", dataType: tableau.dataTypeEnum.string},
				{id: "HQAddress", dataType: tableau.dataTypeEnum.string},
				{id: "HQAddress1", dataType: tableau.dataTypeEnum.string},
				{id: "HQCity", dataType: tableau.dataTypeEnum.string},
				{id: "HQState", dataType: tableau.dataTypeEnum.string},
				{id: "HQStateAbbr", dataType: tableau.dataTypeEnum.string},
				{id: "HQCountryCode", dataType: tableau.dataTypeEnum.string},
				{id: "HQStateFull", dataType: tableau.dataTypeEnum.string},
				{id: "HQZipCode", dataType: tableau.dataTypeEnum.string},
				{id: "Website", dataType: tableau.dataTypeEnum.string},
				{id: "CompanyName", dataType: tableau.dataTypeEnum.string},
				{id: "FunctionalGroupId", dataType: tableau.dataTypeEnum.int}
			]
		};

		var financialTable = {
			id: "HospitalFinancial",
			columns: [
				{id: "HospitalId", dataType: tableau.dataTypeEnum.int},
				{id: "TotPatRev", dataType: tableau.dataTypeEnum.int},
				{id: "PctPatDis", dataType: tableau.dataTypeEnum.float},
				{id: "AlwForUnclct", dataType: tableau.dataTypeEnum.float},
				{id: "TotCurtAss", dataType: tableau.dataTypeEnum.int},
				{id: "TotOthAss", dataType: tableau.dataTypeEnum.int},
				{id: "CstPerDCCMIAdj", dataType: tableau.dataTypeEnum.float},
				{id: "CstPerDCCMIAdjSt", dataType: tableau.dataTypeEnum.float},
				{id: "CstPerDCCMIWageAdj", dataType: tableau.dataTypeEnum.float},
				{id: "CstPerDCCMIWageAdjSt", dataType: tableau.dataTypeEnum.float},
				{id: "TotConLbr", dataType: tableau.dataTypeEnum.float},
				{id: "TotFriBen", dataType: tableau.dataTypeEnum.float},
				{id: "LabCompRat", dataType: tableau.dataTypeEnum.float},
				{id: "TotOverCsts", dataType: tableau.dataTypeEnum.int},
				{id: "DepExp", dataType: tableau.dataTypeEnum.float},
				{id: "GenFndBal", dataType: tableau.dataTypeEnum.int},
				{id: "LiabFndBal", dataType: tableau.dataTypeEnum.float},
				{id: "DbtToEquRat", dataType: tableau.dataTypeEnum.float},
				{id: "BadDebtARRat", dataType: tableau.dataTypeEnum.float},
				{id: "CMI", dataType: tableau.dataTypeEnum.float},
				{id: "CmiMed", dataType: tableau.dataTypeEnum.float},
				{id: "CmiSur", dataType: tableau.dataTypeEnum.float},
				{id: "MccCcRat", dataType: tableau.dataTypeEnum.float},
				{id: "BedUti", dataType: tableau.dataTypeEnum.float},
				{id: "AdjPatDays", dataType: tableau.dataTypeEnum.float},
				{id: "EstErVisAdm", dataType: tableau.dataTypeEnum.float},
				{id: "InpSurg", dataType: tableau.dataTypeEnum.int},
				{id: "NumIntRes", dataType: tableau.dataTypeEnum.int},
				{id: "LbrDelDaysInp", dataType: tableau.dataTypeEnum.float},
				{id: "NrsryDays", dataType: tableau.dataTypeEnum.int},
				{id: "TotFacSqFt", dataType: tableau.dataTypeEnum.float},
				{id: "OpRmSqFt", dataType: tableau.dataTypeEnum.float},
				{id: "DelRmSqFt", dataType: tableau.dataTypeEnum.float},
				{id: "LabSqFt", dataType: tableau.dataTypeEnum.float},
				{id: "InpSqFt", dataType: tableau.dataTypeEnum.float},
				{id: "UnrMcaidCsts", dataType: tableau.dataTypeEnum.float},
				{id: "UnrOthStLoGovIndCsts", dataType: tableau.dataTypeEnum.float},
				{id: "ChaCareChr", dataType: tableau.dataTypeEnum.float},
				{id: "ChCareCsts", dataType: tableau.dataTypeEnum.float},
				{id: "UncCareCsts", dataType: tableau.dataTypeEnum.float},
				{id: "TotUncCareUnrCsts", dataType: tableau.dataTypeEnum.float},
				{id: "PatDis", dataType: tableau.dataTypeEnum.int},
				{id: "ItOpSpd", dataType: tableau.dataTypeEnum.float},
				{id: "QuickRat", dataType: tableau.dataTypeEnum.float},
				{id: "TotDays", dataType: tableau.dataTypeEnum.float},
				{id: "InpPrtCDays", dataType: tableau.dataTypeEnum.float},
				{id: "EstTotClaimsOtp", dataType: tableau.dataTypeEnum.int},
				{id: "NumDenClmMcare", dataType: tableau.dataTypeEnum.float},
				{id: "PctDenClmsMcare", dataType: tableau.dataTypeEnum.float},
				{id: "TotOthInc", dataType: tableau.dataTypeEnum.int},
				{id: "DshPayMcare", dataType: tableau.dataTypeEnum.float},
				{id: "AlwDsh", dataType: tableau.dataTypeEnum.float},
				{id: "ReAdmiRatPnltyFy2016", dataType: tableau.dataTypeEnum.float},
				{id: "EstReAdmiPnltyFy2016", dataType: tableau.dataTypeEnum.float},
				{id: "VbpPctFy2016", dataType: tableau.dataTypeEnum.float},
				{id: "EstVbpAdjFy2016", dataType: tableau.dataTypeEnum.float},
				{id: "LndryLinenCst", dataType: tableau.dataTypeEnum.float},
				{id: "HacPnltyFy2016", dataType: tableau.dataTypeEnum.float},
				{id: "EstHacPnltyFy2016", dataType: tableau.dataTypeEnum.float},
				{id: "MningflUsePymnt", dataType: tableau.dataTypeEnum.float},
				{id: "HouseKpingCst", dataType: tableau.dataTypeEnum.float},
				{id: "DtryCst", dataType: tableau.dataTypeEnum.float},
				{id: "SplyCsts", dataType: tableau.dataTypeEnum.float},
				{id: "TotSplyCsts", dataType: tableau.dataTypeEnum.float},
				{id: "PhrmcyCsts", dataType: tableau.dataTypeEnum.float},
				{id: "OtpSqFt", dataType: tableau.dataTypeEnum.float},
				{id: "AvgAgePlnt", dataType: tableau.dataTypeEnum.float},
				{id: "PctSsiToPrtADays", dataType: tableau.dataTypeEnum.float},
				{id: "PctMcaidToTotDays", dataType: tableau.dataTypeEnum.float},
				{id: "NonMcareNonReimbBadDbtCsts", dataType: tableau.dataTypeEnum.float},
				{id: "ReAdmiReduAdjFy2017", dataType: tableau.dataTypeEnum.float},
				{id: "ReAdmiReduPnltyFy2017", dataType: tableau.dataTypeEnum.float},
				{id: "VBPPcntFy2017", dataType: tableau.dataTypeEnum.float},
				{id: "VBPPAdjFy2017", dataType: tableau.dataTypeEnum.float},
				{id: "AccrAgn", dataType: tableau.dataTypeEnum.string},
				{id: "EstReAdmiReduAdjFy2013", dataType: tableau.dataTypeEnum.float},
				{id: "EstVBPAdjFy2013", dataType: tableau.dataTypeEnum.float},
				{id: "EstReAdmiReduAdjFy2014", dataType: tableau.dataTypeEnum.float},
				{id: "EstVBPAdjFy2014", dataType: tableau.dataTypeEnum.float},
				{id: "EstHACPnltyFy2015", dataType: tableau.dataTypeEnum.float},
				{id: "EstReAdmiPnltyFy2015", dataType: tableau.dataTypeEnum.float},
				{id: "EstVBPAdjFy2015", dataType: tableau.dataTypeEnum.float},
				{id: "EstHACPnltyFy2017", dataType: tableau.dataTypeEnum.float},
				{id: "HACPnltyFy2017", dataType: tableau.dataTypeEnum.float}
			]
		};
		
		var rfpTable = {
			id: "RFPs",
			columns: [
				{id: "Id", dataType: tableau.dataTypeEnum.int},
				{id: "HospitalId", dataType: tableau.dataTypeEnum.int},
				{id: "NameOfIssuer", dataType: tableau.dataTypeEnum.string},
				{id: "Title", dataType: tableau.dataTypeEnum.string},
				{id: "DateDue", dataType: tableau.dataTypeEnum.datetime},
				{id: "DateModified", dataType: tableau.dataTypeEnum.datetime},
				{id: "DateEntered", dataType: tableau.dataTypeEnum.datetime},
				{id: "Description", dataType: tableau.dataTypeEnum.string},
				{id: "RFPIdentifier", dataType: tableau.dataTypeEnum.string},
				{id: "RFPType", dataType: tableau.dataTypeEnum.string},
				{id: "Category1", dataType: tableau.dataTypeEnum.string},
				{id: "CategoryBroad", dataType: tableau.dataTypeEnum.string},
				{id: "Website", dataType: tableau.dataTypeEnum.string},
				{id: "CategoryImportant", dataType: tableau.dataTypeEnum.string},
				{id: "ContactName", dataType: tableau.dataTypeEnum.string},
				{id: "ContactEmail", dataType: tableau.dataTypeEnum.string},
				{id: "ContactPhone", dataType: tableau.dataTypeEnum.string},
				{id: "ContactTitle", dataType: tableau.dataTypeEnum.string},
				{id: "SponsorName", dataType: tableau.dataTypeEnum.string}
			]
		};

		var newsItemsTable = {
			id: "NewsItems",
			columns: [
				{id: "Id", dataType: tableau.dataTypeEnum.int},
				{id: "NewsEventDate", dataType: tableau.dataTypeEnum.datetime},
				{id: "NewsEventTitle", dataType: tableau.dataTypeEnum.string},
				{id: "NewsEventType", dataType: tableau.dataTypeEnum.string},
				{id: "NewsEventDetails", dataType: tableau.dataTypeEnum.string},
				{id: "HospitalId", dataType: tableau.dataTypeEnum.int},
				{id: "HospitalName", dataType: tableau.dataTypeEnum.string},
				{id: "FirmType", dataType: tableau.dataTypeEnum.string},
				{id: "HQCity", dataType: tableau.dataTypeEnum.string},
				{id: "HQState", dataType: tableau.dataTypeEnum.string},
				{id: "FirstCompanyName", dataType: tableau.dataTypeEnum.string},
				{id: "FirstCompanyProfile", dataType: tableau.dataTypeEnum.string},
				{id: "SecondCompanyId", dataType: tableau.dataTypeEnum.int},
				{id: "SecondCompanyName", dataType: tableau.dataTypeEnum.string},
				{id: "SecondCompanyProfile", dataType: tableau.dataTypeEnum.string}
			]
		};

		schemaCallback([hospitalTable, executiveTable, financialTable, rfpTable, newsItemsTable]);
	};

	myConnector.getData = function (table, doneCallback) {
		var conData = JSON.parse(tableau.connectionData);
		var bearer = conData.access_token;

		if (conData.defIdsA.length == 0 && conData.zipsA.length == 0 && conData.statesA.length == 0 && conData.filter == "" && conData.networkIdsA.length == 0 && conData.networkParentIdsA.length == 0)
		{
			tableau.abortWithError("Please, define at least one search option.");
			return;
		}

		var expandSuffix = "";
		if (table.tableInfo.id == "Hospital")
			expandSuffix = "";
		else if (table.tableInfo.id == "Executive")
			expandSuffix = "?$expand=Executives";
		else if (table.tableInfo.id == "HospitalFinancial")
			expandSuffix = "?$expand=Fin";
		else if (table.tableInfo.id == "RFPs")
			expandSuffix = "?$expand=RFPs";
		else if (table.tableInfo.id == "NewsItems")
			expandSuffix = "?$expand=NewsItems";
		else
		{
			tableau.abortWithError("Unknown table id.");
			return;
		}


		// filter
		const kUrl = "https://api.defhc.com/v4/odata-v4/Hospitals";
		var filter = makeFilter(conData);
		var idPromise = new Promise(function(resolve, reject) {
			$.ajax({
				url: kUrl + "?$select=Id&$filter=" + filter,
				type: 'GET',
				dataType: 'json',
				beforeSend: function(xhr){ xhr.setRequestHeader("Authorization", "Bearer " + bearer);  },
				error: function(jqXHR, textStatus, errorThrown){
					tableau.log("Fetch error result: " + jqXHR.responseText);
					resolve([]);
					},
				success: function(requestData) {
					var ids = [];
					for (obj of requestData.value) ids.push(obj.Id);
					resolve(ids);
					}
				});
		});

		idPromise.then(function(defIdsA) {
			if (defIdsA.length == 0) {
				tableau.log("Nothing found.");
				doneCallback();
				return;
			}

			var getFetches = [];
			for (var defIdsI = 0; defIdsI < defIdsA.length; defIdsI++)
			{
				var defId = defIdsA[defIdsI];
				var getFetch = new Promise(function(resolve, reject)
					{
						var requestUrl = kUrl + "(" + defId + ")" + expandSuffix;
						$.ajax({
							url: requestUrl,
							type: 'GET',
							dataType: 'json',
							_hospId: defId,
							beforeSend: function(xhr){ xhr.setRequestHeader("Authorization", "Bearer " + bearer);  },
							error: function(jqXHR, textStatus, errorThrown){
								if (table.tableInfo.id == "Hospital")
									table.appendRows([{"Id": this["_hospId"], "Name": "Wrong ID"}]);
								tableau.log("Fetch error: " + errorThrown);
								resolve();
								},
							success: function(requestData){
								if (table.tableInfo.id == "Hospital")
									table.appendRows([requestData]);
								else if (table.tableInfo.id == "Executive")
									table.appendRows(requestData["Executives"]);
								else if (table.tableInfo.id == "HospitalFinancial")
									table.appendRows([requestData["Fin"]]);
								else if (table.tableInfo.id == "RFPs")
									table.appendRows(requestData["RFPs"]);
								else if (table.tableInfo.id == "NewsItems")
									table.appendRows(requestData["NewsItems"]);
								resolve();
								}
							});
					});
				getFetches.push(getFetch);
			}
			Promise.all(getFetches).then(function(values){ doneCallback(); });

		});
	};

	tableau.registerConnector(myConnector);

	$(document).ready(function () {
		$("#userName")[0].value = "";
		$("#userPassword")[0].value = "";


		$("#submitButton").click(function () {
			
		var userName = $("#userName").val().trim();
		var userPassword = $("#userPassword").val().trim();
		var inputData = getInputData();
		//tableau.log("inputData = " + JSON.stringify(inputData));

		$.ajax({
			url: 'https://api.defhc.com/v4/token',
			type: 'POST',
			dataType: 'json',
			data: 'grant_type=password&username=' + userName + '&password=' + userPassword,
			error: function() { tableau.abortWithError('Authentication error!'); },
			success: function(data) {
				Object.assign(data, inputData);
				tableau.connectionName = "Definitive Healthcare Feed";
				tableau.connectionData = JSON.stringify(data);
				tableau.submit();
				}
			});
		
		});


		$('.form-control, [type=checkbox]').on("input", function() {
			try {
				let inputData = getInputData();

				let valueCount = 0;
				Object.values(inputData).forEach(val => {if (val instanceof Array) valueCount += val.length});
				$('#querytext').toggleClass("warning", valueCount > 20);

				$('#querytext').text(makeFilter(inputData));
			} catch(e) {
				$('#querytext').text("");
			}
		});
	});



	function getInputData() {
		function makeArray(val) {
			var res = val.split(",");
			res.forEach((el, i, ar) => ar[i] = el.trim());
			return res.filter(el => el != "");
		}

		return {
			defIdsA: makeArray($("#defIds").val()),
			zipsA: makeArray($("#Zips").val()), zips_Or: $("#Zips_Or").is(":checked"),
			statesA: makeArray($("#States").val()), states_Or: $("#States_Or").is(":checked"),
			filter: $("#Filter").val().trim(), filter_Or: $("#Filter_Or").is(":checked"),
			networkIdsA: makeArray($("#NetworkIds").val()), networkIds_Or: $("#NetworkIds_Or").is(":checked"),
			networkParentIdsA: makeArray($("#NetworkParentIds").val()), networkParentIds_Or: $("#NetworkParentIds_Or").is(":checked")
		};
	}



	function makeFilter(params) {
		function makeIntFilter(vals, fname) {
			return "(" + fname + " eq " + vals.join(" or " + fname + " eq ") + ")";
		}
		
		var filterAnd = [], filterOr = [];
		if (params.defIdsA.length > 0) filterAnd.push(makeIntFilter(params.defIdsA, "Id"));
		if (params.zipsA.length > 0) {
			let flt = makeIntFilter(params.zipsA, "Zip");
			if (params.zips_Or) filterOr.push(flt);
			else filterAnd.push(flt);
		}
		if (params.statesA.length > 0) {
			let flt = "(contains(State, '" + params.statesA.join("') or contains(State, '") + "'))";
			if (params.states_Or) filterOr.push(flt);
			else filterAnd.push(flt);
		}
		if (params.networkIdsA.length > 0) {
			let flt = makeIntFilter(params.networkIdsA, "NetworkId");
			if (params.networkIds_Or) filterOr.push(flt);
			else filterAnd.push(flt);
		}
		if (params.networkParentIdsA.length > 0) {
			let flt = makeIntFilter(params.networkParentIdsA, "NetworkParentId");
			if (params.networkParentIds_Or) filterOr.push(flt);
			else filterAnd.push(flt);
		}
		if (params.filter != "") {
			let flt = "(" + params.filter + ")"
			if (params.filter_Or) filterOr.push(flt);
			else filterAnd.push(flt);
		}

		var filter = filterAnd.join(" and ");
		if (filterOr.length > 0) {
			if (filter != "") filter += " or ";
			filter += filterOr.join(" or ");
		}
		return filter;
	}

})();
</script>

<style type="text/css">
	p, ul {
		text-align: left;
	}

	label {
		margin-top: 0.5em;
		margin-bottom: 0;
	}

	.bigspace {
		margin-top: 1.5em;
	}

	.conjunction {
		color: gray;
	}

	.querytext {
		text-align: left;
	}

	.querytext label {
		font-size: 90%;
		font-style: italic;
		font-weight: normal;
		font-family: Menlo;
		background-color: rgb(230, 230, 230);
	}

	.querytext .warning {
		background-color: rgb(230, 150, 0);
	}
</style>
</head>

<body>

<div class="container container-table">
	<div class="row vertical-center-row">
		<div class="text-center col-md-4 col-md-offset-4">
			<label class="control-label">User Name</label><input type="text" id="userName" class="form-control">
			<label class="control-label">Password</label><input type="password" id="userPassword" class="form-control">
			<label class="control-label bigspace">Definitive IDs (separate with comma)</label>
			<input type="text" id="defIds" class="form-control">
			
			<label class="control-label">Zips</label>
			<label class="conjunction">( <input type="checkbox" id="Zips_Or">OR )</label>
			<input type="text" id="Zips" class="form-control">
			
			<label class="control-label">States</label>
			<label class="conjunction">( <input type="checkbox" id="States_Or">OR )</label>
			<input type="text" id="States" class="form-control">
			
			<label class="control-label">Network IDs</label>
			<label class="conjunction">( <input type="checkbox" id="NetworkIds_Or">OR )</label>
			<input type="text" id="NetworkIds" class="form-control">
			
			<label class="control-label">Network Parent IDs</label>
			<label class="conjunction">( <input type="checkbox" id="NetworkParentIds_Or">OR )</label>
			<input type="text" id="NetworkParentIds" class="form-control">

			<label class="control-label bigspace">Filter</label>
			<label class="conjunction">( <input type="checkbox" id="Filter_Or">OR )</label>
			<input type="text" id="Filter" class="form-control">

			<p class="querytext bigspace">
				<label id="querytext"></label>
			</p>

			<p>Use column names from the Hospital table and single quotes only.<br>
			The <i>$filter</i> syntax is available <a href="http://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part2-url-conventions.html#sec_CommonExpressionSyntax" target="_blank">here.</a><br>
			Examples:</p>
			<ul>
				<li>Id eq 4703</li>
				<li>Zip eq '80112' and contains(State, 'CO')</li>
				<li>State ne 'TX' and Id eq 4703</li>
				<li>NumBeds gt 500 and contains(Name, 'Mass')</li>
				<li>NetworkId eq 4703 or NetworkId eq 513</li>
			</ul>
			<button type="button" id="submitButton" class="btn btn-success" style="margin: 10px;">Get Data!</button>
		</div>
	</div>
</div>

</body>

</html>
